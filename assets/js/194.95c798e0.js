(window.webpackJsonp=window.webpackJsonp||[]).push([[194],{472:function(s,t,a){"use strict";a.r(t);var n=a(14),e=Object(n.a)({},(function(){var s=this,t=s._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"websocket"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#websocket"}},[s._v("#")]),s._v(" websocket")]),s._v(" "),t("h2",{attrs:{id:"示例"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#示例"}},[s._v("#")]),s._v(" 示例")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# websocket-client==1.3.2")]),s._v("\nfrom websocket "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("import")]),s._v(" WebSocketApp, _exceptions\nfrom concurrent.futures "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("import")]),s._v(" ThreadPoolExecutor\n\nexecutor "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" ThreadPoolExecutor"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("max_workers"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\nscheculer_ws "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" None\n\nclass WebsocketHandler"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("WebSocketApp"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(":\n    def __init__"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("self, url, "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ws_name")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ws"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(":\n        super"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(".__init__"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("url"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("url"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        self.namespace "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" ws_name\n        self.on_message "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" self.on_message_callback\n        self.on_error "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" self.on_error_callback\n        self.on_close "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" self.on_close_callback\n        self.on_open "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" self.on_open_callback\n\n    def on_message_callback"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("self, ws, message"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(":    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 服务器有数据更新时，主动推送过来的数据")]),s._v("\n        pass\n\n    def on_error_callback"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("self, ws, error"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(":        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 程序报错时，就会触发on_error事件")]),s._v("\n        pass\n\n    def on_close_callback"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("self, *args,**kwargs"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(":\n        pass\n\n    def on_open_callback"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("self, ws"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(":                "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 连接到服务器之后就会触发on_open事件，这里用于send数据")]),s._v("\n        pass\n\n    def work_spin"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("self"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(":\n        print"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"work_spin executed"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("while")]),s._v(" True:\n            try:\n                self.run_forever"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("ping_timeout"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                time.sleep"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("continue")]),s._v("\n            except KeyboardInterrupt:\n                self.close"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("break")]),s._v("\n\nscheculer_ws "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" WebsocketHandler"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("url"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("settings.WFM_URL, "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ws_name")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"scheduler_ws"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nexecutor.submit"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("scheculer_ws.work_spin"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])])])])}),[],!1,null,null,null);t.default=e.exports}}]);