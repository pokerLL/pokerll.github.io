(window.webpackJsonp=window.webpackJsonp||[]).push([[345],{624:function(t,a,s){"use strict";s.r(a);var r=s(14),e=Object(r.a)({},(function(){var t=this,a=t._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"分析python服务生成的coredump文件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#分析python服务生成的coredump文件"}},[t._v("#")]),t._v(" 分析python服务生成的coredump文件")]),t._v(" "),a("h2",{attrs:{id:"配置生成coredump文件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#配置生成coredump文件"}},[t._v("#")]),t._v(" 配置生成coredump文件")]),t._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[t._v("步骤一：开启core dump文件生成\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("ulimit")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-c")]),t._v(" unlimited\n步骤二：设置core dump文件位置\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("vi")]),t._v(" /etc/sysctl.conf\n修改（添加）如下两个变量\nkernel.core_pattern "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("/var/core/core_%e_%p\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("kernel.core_uses_pid")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\n这里是改为生成目录在/var/core/，%e代表程序名称，%p是进程ID\n如果想直接生成在可执行文件相同目录，前面不要加任何目录，直接\nkernel.core_pattern "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("core_%e_%p\n步骤三：让修改生效\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sysctl")]),t._v(" -p/etc/sysctl.conf\n")])])]),a("p",[t._v("获取到coredump文件之后，我们将名字命名为core.file")]),t._v(" "),a("h2",{attrs:{id:"安装环境"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装环境"}},[t._v("#")]),t._v(" 安装环境")]),t._v(" "),a("h3",{attrs:{id:"安装gdb"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装gdb"}},[t._v("#")]),t._v(" 安装gdb")]),t._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[t._v("yum "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-y")]),t._v(" gdb*\n")])])]),a("p",[t._v("‍")]),t._v(" "),a("h3",{attrs:{id:"安装python-debuginfo"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装python-debuginfo"}},[t._v("#")]),t._v(" 安装python-debuginfo")]),t._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[t._v(" yum "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-y")]),t._v(" python3-debuginfo\n")])])]),a("p",[t._v("这里安装python-debuginfo主要是使用py-bt等命令用来显示python的堆栈中的详细信息，如果没有找到对应的版本，可以下载pythn源码，从源码中获取在gdb的过程进行加载，使用方法如下：")]),t._v(" "),a("div",{staticClass:"language-cobol extra-class"},[a("pre",{pre:!0,attrs:{class:"language-cobol"}},[a("code",[t._v("  $ gdb\n  $ gdb"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("source")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("{python3"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("8CodePath}"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("Tools"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("gdb"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("libpython"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("py\n")])])]),a("h2",{attrs:{id:"使用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#使用"}},[t._v("#")]),t._v(" 使用")]),t._v(" "),a("h3",{attrs:{id:"查看具体的python版本号"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#查看具体的python版本号"}},[t._v("#")]),t._v(" 查看具体的python版本号")]),t._v(" "),a("div",{staticClass:"language-ruby extra-class"},[a("pre",{pre:!0,attrs:{class:"language-ruby"}},[a("code",[t._v("$ gdb core"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("file\n$ gdb"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" info proc mappings\n")])])]),a("p",[t._v("因此能够显示看出这个core文件中使用的python版本号（主要是通过看python的路径，再根据python的路径去找到对应的版本）")]),t._v(" "),a("h3",{attrs:{id:"下载并加载符号表"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#下载并加载符号表"}},[t._v("#")]),t._v(" 下载并加载符号表")]),t._v(" "),a("p",[t._v("在已经知道了对应python版本之后就去下载对应版本的符号表，一般是python-**.zip1命名")]),t._v(" "),a("p",[t._v("如果环境没有对应的python版本也可以去下载一个对应的版本，然后将符号表解压出来，将python.dbg拷贝到python的bin目录下")]),t._v(" "),a("div",{staticClass:"language-cobol extra-class"},[a("pre",{pre:!0,attrs:{class:"language-cobol"}},[a("code",[t._v("cp {py_1}"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("output")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("python"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("dbg {py}"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("bin"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("\n")])])]),a("p",[t._v("符号表主要是用于解析C堆栈的，如果没有符号表，bt显示的堆栈可能不全，或者有些部分显示")]),t._v(" "),a("p",[t._v("‍")]),t._v(" "),a("h2",{attrs:{id:"分析"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#分析"}},[t._v("#")]),t._v(" 分析")]),t._v(" "),a("div",{staticClass:"language-cobol extra-class"},[a("pre",{pre:!0,attrs:{class:"language-cobol"}},[a("code",[t._v("$ gdb -q {py}"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("bin"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("python core"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("file")]),t._v(" \n$ gdb"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("source")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("{python3"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("8CodePath}"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("Tools"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("gdb"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("libpython"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("py\n$ py-bt\n")])])]),a("p",[t._v("这里就能找到对应的代码出问题的地方，然后需要对照代码进行分析")])])}),[],!1,null,null,null);a.default=e.exports}}]);