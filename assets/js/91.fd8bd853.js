(window.webpackJsonp=window.webpackJsonp||[]).push([[91],{369:function(t,s,n){"use strict";n.r(s);var a=n(14),e=Object(a.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"mmap-内存映射文件"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#mmap-内存映射文件"}},[t._v("#")]),t._v(" mmap-内存映射文件")]),t._v(" "),s("h2",{attrs:{id:"概述"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#概述"}},[t._v("#")]),t._v(" 概述")]),t._v(" "),s("p",[t._v("mmap模块是Python标准库中的一个模块，它提供了一种内存映射文件的方式。操作系统会为访问的文件建立一段虚拟内存，并在需要的时候将相应部分调入内存。")]),t._v(" "),s("p",[t._v("​"),s("code",[t._v("mmap")]),t._v("​对象支持切片、索引、迭代等操作，也支持文件读写和同步操作，具有很强的灵活性和可扩展性。但是需要注意的是，在使用"),s("code",[t._v("mmap")]),t._v("​对象的过程中需要小心处理文件指针，以避免读写文件数据时的错误。")]),t._v(" "),s("p",[t._v("相较于传统的文件读取的方式，这种内存映射的方式更加简单并且更加符合Python的操作习惯。")]),t._v(" "),s("p",[t._v("​"),s("code",[t._v("mmap")]),t._v("​模块的核心是"),s("code",[t._v("mmap()")]),t._v("​函数，它接受一个文件描述符和文件映射模式（如"),s("code",[t._v("ACCESS_READ")]),t._v("​、"),s("code",[t._v("ACCESS_WRITE")]),t._v("​等），并返回一个"),s("code",[t._v("mmap")]),t._v("​对象。通过这个对象，我们可以像访问普通的Python字节数组一样操作文件数据。​"),s("code",[t._v("mmap()")]),t._v("​函数有以下参数：")]),t._v(" "),s("ul",[s("li",[t._v("​"),s("code",[t._v("fileno")]),t._v("​：表示文件描述符，如果要映射的对象是一个文件，可以使用文件对象的"),s("code",[t._v("fileno()")]),t._v("​方法来获取其对应的文件描述符，如果要映射的对象是一个类文件对象，可以直接传递其文件描述符。")]),t._v(" "),s("li",[t._v("​"),s("code",[t._v("length")]),t._v("​：表示映射的内存大小，如果指定为0，则表示映射整个文件。")]),t._v(" "),s("li",[t._v("​"),s("code",[t._v("access")]),t._v("​：表示映射的内存区域的访问权限，包括"),s("code",[t._v("ACCESS_READ")]),t._v("​、"),s("code",[t._v("ACCESS_WRITE")]),t._v("​和"),s("code",[t._v("ACCESS_COPY")]),t._v("​三种模式，分别表示读、写和复制。")]),t._v(" "),s("li",[t._v("​"),s("code",[t._v("offset")]),t._v("​：表示映射的文件偏移量，即从文件的哪个位置开始映射，如果未指定，则从文件的开头开始映射。")])]),t._v(" "),s("p",[t._v("‍")]),t._v(" "),s("h2",{attrs:{id:"使用示例"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#使用示例"}},[t._v("#")]),t._v(" 使用示例")]),t._v(" "),s("h3",{attrs:{id:"读"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#读"}},[t._v("#")]),t._v(" 读")]),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" mmap\n\n"),s("span",{pre:!0,attrs:{class:"token triple-quoted-string string"}},[t._v('"""\nabcdefeg\n1234567\nlei\n"""')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# with open('C:\\Workspace\\Program\\CPythonTest\\PyTests\\example.txt','r') as f:")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("with")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("open")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'example.txt'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'r'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v(" f"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("with")]),t._v(" mmap"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("mmap"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("f"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("fileno"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" access"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("mmap"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ACCESS_READ"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v(" mm"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 切片操作")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("print")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("mm"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("print")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"###############"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n      \n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 索引操作")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("print")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("mm"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("print")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"###############"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 迭代操作")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" byte "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" mm"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("print")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("byte"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n      \n\n"),s("span",{pre:!0,attrs:{class:"token triple-quoted-string string"}},[t._v("\"\"\"\nb'abcdefeg\\r\\n'\n###############\n49\n###############\nb'a'\nb'b'\nb'c'\nb'd'\nb'e'\nb'f'\nb'e'\nb'g'\nb'\\r'\nb'\\n'\nb'1'\nb'2'\nb'3'\nb'4'\nb'5'\nb'6'\nb'7'\nb'\\r'\nb'\\n'\nb'l'\nb'e'\nb'i\n\"\"\"")]),t._v("\n\n")])])]),s("h3",{attrs:{id:"写"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#写"}},[t._v("#")]),t._v(" 写")]),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" mmap\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 打开文件并创建mmap对象")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("with")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("open")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"example.txt"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"r+b"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v(" f"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("with")]),t._v(" mmap"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("mmap"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("f"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("fileno"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v(" mm"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("print")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("mm"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# b'abcdefeg\\r\\n1234567\\r\\nlei'")]),t._v("\n\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 在mmap对象上修改文件内容")]),t._v("\n        mm"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('b"1111"')]),t._v("\n\n        mm"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("flush"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("print")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("mm"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# b'1111efeg\\r\\n1234567\\r\\nlei'")]),t._v("\n\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 关闭mmap对象")]),t._v("\n        mm"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("close"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])])])}),[],!1,null,null,null);s.default=e.exports}}]);