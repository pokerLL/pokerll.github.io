(window.webpackJsonp=window.webpackJsonp||[]).push([[64],{533:function(s,t,a){"use strict";a.r(t);var n=a(14),e=Object(n.a)({},(function(){var s=this,t=s._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"线程安全和gil"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#线程安全和gil"}},[s._v("#")]),s._v(" 线程安全和GIL")]),s._v(" "),t("p",[s._v("‍")]),s._v(" "),t("h2",{attrs:{id:"线程安全"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#线程安全"}},[s._v("#")]),s._v(" 线程安全")]),s._v(" "),t("ul",[t("li",[s._v("需要注意，Python的内建对象都是线程安全的，但是其对象源码中并没有使用任何互斥锁，主要在于对其修改的操作都是由单个字节码完成的")]),s._v(" "),t("li",[s._v("GIL保证了Python虚拟机每次一定会完整的执行完一条字节码才有可能切换到下一个线程，而字节码如LOAD_CONST背后对应的是C语言的多条语句。如果没有GIL，那么在执行这条字节码的过程中发生切换，即没有完成的执行完背后的C语言语句，就会造成数据错误。")]),s._v(" "),t("li",[s._v("即GIL保证了字节码层面的线程安全。")])]),s._v(" "),t("p",[s._v("‍")]),s._v(" "),t("p",[s._v("‍")]),s._v(" "),t("h2",{attrs:{id:"​store-subscr​"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#​store-subscr​"}},[s._v("#")]),s._v(" ​"),t("code",[s._v("STORE_SUBSCR")]),s._v("​")]),s._v(" "),t("p",[s._v("​"),t("code",[s._v("STORE_SUBSCR")]),s._v("​ 是一个 Python 字节码指令，它的作用是将一个值存储到指定对象的子元素中，这个指令的操作数有三个，分别是存储对象、索引和值，它们分别表示要存储值的对象、子元素的索引和要存储的值。")]),s._v(" "),t("p",[s._v("具体来说，"),t("code",[s._v("STORE_SUBSCR")]),s._v("​ 的作用就是执行以下操作：")]),s._v(" "),t("ol",[t("li",[s._v("从操作数栈中弹出三个值，分别是存储对象、索引和要存储的值。")]),s._v(" "),t("li",[s._v("执行存储操作，将值存储到对象的指定子元素中。")])]),s._v(" "),t("p",[s._v("​"),t("code",[s._v("STORE_SUBSCR")]),s._v("​ 的操作与 Python 表达式 "),t("code",[s._v("a[b] = c")]),s._v("​ 的语义一致，即将值 "),t("code",[s._v("c")]),s._v("​ 存储到对象 "),t("code",[s._v("a")]),s._v("​ 的子元素 "),t("code",[s._v("b")]),s._v("​ 中。")]),s._v(" "),t("p",[s._v("注意，"),t("code",[s._v("STORE_SUBSCR")]),s._v("​ 操作需要保证存储对象是可变的，否则会引发 "),t("code",[s._v("TypeError")]),s._v("​ 异常。")]),s._v(" "),t("div",{staticClass:"language-python extra-class"},[t("pre",{pre:!0,attrs:{class:"language-python"}},[t("code",[s._v("a "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("dict")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\na"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\na"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\n")])])]),t("div",{staticClass:"language-python extra-class"},[t("pre",{pre:!0,attrs:{class:"language-python"}},[t("code",[s._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("           "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" LOAD_NAME                "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("dict")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n              "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" CALL_FUNCTION            "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n              "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" STORE_NAME               "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("a"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("           "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v(" LOAD_CONST               "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n              "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(" LOAD_NAME                "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("a"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n             "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(" LOAD_CONST               "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n             "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(" STORE_SUBSCR\n\n  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("          "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),s._v(" LOAD_CONST               "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n             "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(" LOAD_NAME                "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("a"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n             "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("18")]),s._v(" LOAD_CONST               "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n             "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v(" STORE_SUBSCR\n             "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("22")]),s._v(" LOAD_CONST               "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("None")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n             "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("24")]),s._v(" RETURN_VALUE\n")])])]),t("p",[s._v("‍")])])}),[],!1,null,null,null);t.default=e.exports}}]);